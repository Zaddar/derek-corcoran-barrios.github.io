---
title: "Regresiones lineales y pivots"
author: "Derek Corcoran"
date: "`r format(Sys.time(), '%d/%m, %Y')`"
output:
  ioslides_presentation:
    widescreen: true
    incremental: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE, tidy = TRUE, tidy.opts = list(width.cutoff = 50))
library(tidyverse)
library(broom)
library(kableExtra)
library(knitr)
options("kableExtra.html.bsTable" = T)
```

# Modelos

## ¿Qué es un modelo?

* Un modelo es una versión simplificada de la realidad que nos permite hacer inferencias o prediccións sobre una población
* Un modelo es un resumen adecuado de la realidad
* Un modelo es una simplificación or aproximación a la realidad y por ende no reflejará toda la realidad (Burnham y Anderson)
* Todos los modelos estan equivocados, algunos son útiles (George Box)

# Veamos un ejemplo

## Altura versus DAP

```{r}
githubURL <- ("https://raw.githubusercontent.com/Curso-programacion/Datos_Arboles/master/Data.rds")
download.file(githubURL,"Data.rds", method="curl")
Data <- read_rds("Data.rds")
```

```{r, echo = F, include=FALSE}
file.remove("Data.rds")
```

## Veamos los datos

```{r,echo = F}
ggplot(Data, aes(x = Altura, DAP)) + geom_point() + theme_bw()
```


## Formula de un modelo

```{r, echo = TRUE, eval=FALSE}
alguna_funcion(Y ~ X1 + X2 + ... + Xn, data = data.frame)
```

* **Y:** Variable respuesta (Captación de $CO_2$)
* **`~`:** Explicado por
* **$X_n$:** Variable explicativa n (Subespecie, tratamiento, etc.)
* **data.frame:*** Base de datos (CO2)
* **alguna_funcion:** El modelo a testear (nuestra simplificación de la realidad)

## Algunos modelos en R

```{r Modelos, echo = FALSE}
Modelos <- data.frame(Modelos = c("Prueba de t" ,"ANOVA", "Modelo lineal simple", "modelo lineal generalizado", "Modelo aditivo", "Modelo no lineal", "modelos lineales mixtos", "Boosted regression trees"), Funcion = c("t.test()", "aov()", "lm()", "glm()", "gam()", "nls()", "lmer()", "gbm()"))

kable(Modelos, row.names = FALSE) %>% kable_styling(bootstrap_options = "striped")
```

## Datos de temperatura y humedad

```{r}
githubURL <- ("https://raw.githubusercontent.com/derek-corcoran-barrios/derek-corcoran-barrios.github.io/master/Clase4/TempHum.rds")
download.file(githubURL,"TempHum.rds", method="curl")
TempHum <- read_rds("TempHum.rds") %>% 
  mutate(Mes = as.numeric(Mes))
```

```{r, echo = F, include=FALSE}
file.remove("TempHum.rds")
```

## stat_smooth más control que geom_smooth

```{r}
library(tidyverse)
VA <- TempHum %>% filter(Ciudad_localidad == "Valdivia") 
```

```{r, echo = FALSE}
kable(VA) %>% kable_styling(bootstrap_options = c("striped")) %>%
  scroll_box(width = "800px", height = "350px")
```

## stat_smooth más control que geom_smooth

```{r}
ggplot(VA, aes(x = Mes, y = Temperatura)) + geom_point() +  stat_smooth(method = "lm") 
```

## Ecuación cuadrática

```{r, echo=FALSE, out.width="400px"}
library(knitr)
include_graphics("https://raw.githubusercontent.com/derek-corcoran-barrios/derek-corcoran-barrios.github.io/master/Clase4/Cuadratica.png")
```


## stat_smooth más control que geom_smooth

```{r}
ggplot(VA, aes(x = Mes, y = Temperatura)) + geom_point() +  stat_smooth(method = "lm", formula = y ~ x + I(x^2)) 
```

## Que podemos hacer con tidyr??

```{r}
library(tidyr)
San <- TempHum %>% filter(Ciudad_localidad == "Quinta Normal") %>%  pivot_longer(cols = c(Temperatura, Humedad),names_to= "Unidad", values_to = "medida")
```

## Que podemos hacer con tidyr?? (Cont.)

```{r}
ggplot(San, aes(x = Mes, y = medida)) + geom_point() +  stat_smooth(method = "lm", formula = y ~ x + I(x^2), aes(fill = Unidad, color = Unidad)) 
```


# Varios gráficos juntos

## Como combinar gráficos con facet_wrap

```{r}
Algunos <- TempHum %>% filter(Ciudad_localidad %in% c("Arica", "Rapa Nui", "La Serena", "Valparaíso", "Quinta Normal", "Concepción", "Valdivia", "Punta Arenas")) %>% pivot_longer(cols = c(Temperatura, Humedad),names_to= "Unidad", values_to = "medida")
```